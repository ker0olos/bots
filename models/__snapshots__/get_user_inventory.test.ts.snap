export const snapshot = {};

snapshot[`model 1`] = `
[
  Expr {
    raw: {
      else: Expr {
        raw: {
          create_index: Expr {
            raw: {
              object: {
                name: "users_discord_id",
                source: Expr {
                  raw: {
                    collection: "user",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "id",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: true,
                values: undefined,
              },
            },
          },
        },
      },
      if: Expr {
        raw: {
          exists: Expr {
            raw: {
              index: "users_discord_id",
            },
          },
        },
      },
      then: Expr {
        raw: {
          params: Expr {
            raw: {
              object: {
                name: "users_discord_id",
                source: Expr {
                  raw: {
                    collection: "user",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "id",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: true,
                values: undefined,
              },
            },
          },
          update: Expr {
            raw: {
              index: "users_discord_id",
            },
          },
        },
      },
    },
  },
]
`;

snapshot[`model 2`] = `
[
  Expr {
    raw: {
      else: Expr {
        raw: {
          create_index: Expr {
            raw: {
              object: {
                name: "guilds_discord_id",
                source: Expr {
                  raw: {
                    collection: "guild",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "id",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: true,
                values: undefined,
              },
            },
          },
        },
      },
      if: Expr {
        raw: {
          exists: Expr {
            raw: {
              index: "guilds_discord_id",
            },
          },
        },
      },
      then: Expr {
        raw: {
          params: Expr {
            raw: {
              object: {
                name: "guilds_discord_id",
                source: Expr {
                  raw: {
                    collection: "guild",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "id",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: true,
                values: undefined,
              },
            },
          },
          update: Expr {
            raw: {
              index: "guilds_discord_id",
            },
          },
        },
      },
    },
  },
]
`;

snapshot[`model 3`] = `
[
  Expr {
    raw: {
      else: Expr {
        raw: {
          create_index: Expr {
            raw: {
              object: {
                name: "inventories_instance_user",
                source: Expr {
                  raw: {
                    collection: "inventory",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "instance",
                            ],
                          },
                        },
                      },
                    },
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "user",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: true,
                values: undefined,
              },
            },
          },
        },
      },
      if: Expr {
        raw: {
          exists: Expr {
            raw: {
              index: "inventories_instance_user",
            },
          },
        },
      },
      then: Expr {
        raw: {
          params: Expr {
            raw: {
              object: {
                name: "inventories_instance_user",
                source: Expr {
                  raw: {
                    collection: "inventory",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "instance",
                            ],
                          },
                        },
                      },
                    },
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "user",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: true,
                values: undefined,
              },
            },
          },
          update: Expr {
            raw: {
              index: "inventories_instance_user",
            },
          },
        },
      },
    },
  },
]
`;

snapshot[`model 4`] = `
[
  Expr {
    raw: {
      else: Expr {
        raw: {
          create_index: Expr {
            raw: {
              object: {
                name: "inventory_characters",
                source: Expr {
                  raw: {
                    collection: "character",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "inventory",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: false,
                values: undefined,
              },
            },
          },
        },
      },
      if: Expr {
        raw: {
          exists: Expr {
            raw: {
              index: "inventory_characters",
            },
          },
        },
      },
      then: Expr {
        raw: {
          params: Expr {
            raw: {
              object: {
                name: "inventory_characters",
                source: Expr {
                  raw: {
                    collection: "character",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "inventory",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: false,
                values: undefined,
              },
            },
          },
          update: Expr {
            raw: {
              index: "inventory_characters",
            },
          },
        },
      },
    },
  },
]
`;

snapshot[`model 5`] = `
[
  Expr {
    raw: {
      else: Expr {
        raw: {
          create_index: Expr {
            raw: {
              object: {
                name: "inventories_last_pull",
                source: Expr {
                  raw: {
                    collection: "inventory",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "instance",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: false,
                values: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "lastPull",
                            ],
                          },
                        },
                      },
                    },
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "ref",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
              },
            },
          },
        },
      },
      if: Expr {
        raw: {
          exists: Expr {
            raw: {
              index: "inventories_last_pull",
            },
          },
        },
      },
      then: Expr {
        raw: {
          params: Expr {
            raw: {
              object: {
                name: "inventories_last_pull",
                source: Expr {
                  raw: {
                    collection: "inventory",
                  },
                },
                terms: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "instance",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
                unique: false,
                values: Expr {
                  raw: [
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "data",
                              "lastPull",
                            ],
                          },
                        },
                      },
                    },
                    Expr {
                      raw: {
                        object: {
                          field: Expr {
                            raw: [
                              "ref",
                            ],
                          },
                        },
                      },
                    },
                  ],
                },
              },
            },
          },
          update: Expr {
            raw: {
              index: "inventories_last_pull",
            },
          },
        },
      },
    },
  },
]
`;

snapshot[`model 6`] = `
[
  Expr {
    raw: {
      else: Expr {
        raw: {
          create_function: Expr {
            raw: {
              object: {
                body: Expr {
                  raw: {
                    query: Expr {
                      raw: {
                        expr: Expr {
                          raw: {
                            in: Expr {
                              raw: {
                                in: Expr {
                                  raw: {
                                    else: Expr {
                                      raw: {
                                        in: Expr {
                                          raw: {
                                            var: "createdInstance",
                                          },
                                        },
                                        let: [
                                          {
                                            createdInstance: Expr {
                                              raw: {
                                                create: Expr {
                                                  raw: {
                                                    collection: "instance",
                                                  },
                                                },
                                                params: Expr {
                                                  raw: {
                                                    object: {
                                                      data: Expr {
                                                        raw: {
                                                          object: {
                                                            guild: Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "guild",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                            inventories: Expr {
                                                              raw: [],
                                                            },
                                                            main: true,
                                                            packs: Expr {
                                                              raw: [],
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                          {
                                            updatedGuild: Expr {
                                              raw: {
                                                params: Expr {
                                                  raw: {
                                                    object: {
                                                      data: Expr {
                                                        raw: {
                                                          object: {
                                                            instances: Expr {
                                                              raw: [
                                                                Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "createdInstance",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              ],
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                                update: Expr {
                                                  raw: {
                                                    from: Expr {
                                                      raw: {
                                                        var: "guild",
                                                      },
                                                    },
                                                    select: "ref",
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        ],
                                      },
                                    },
                                    if: Expr {
                                      raw: {
                                        is_nonempty: Expr {
                                          raw: {
                                            var: "match",
                                          },
                                        },
                                      },
                                    },
                                    then: Expr {
                                      raw: {
                                        get: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                0,
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    },
                                  },
                                },
                                let: [
                                  {
                                    match: Expr {
                                      raw: {
                                        from: Expr {
                                          raw: {
                                            var: "guild",
                                          },
                                        },
                                        select: Expr {
                                          raw: [
                                            "data",
                                            "instances",
                                          ],
                                        },
                                      },
                                    },
                                  },
                                ],
                              },
                            },
                            let: [
                              {
                                guild: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            create: Expr {
                                              raw: {
                                                collection: "guild",
                                              },
                                            },
                                            params: Expr {
                                              raw: {
                                                object: {
                                                  data: Expr {
                                                    raw: {
                                                      object: {
                                                        id: Expr {
                                                          raw: {
                                                            var: "guildId",
                                                          },
                                                        },
                                                        instances: Expr {
                                                          raw: [],
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            match: Expr {
                                              raw: {
                                                index: "guilds_discord_id",
                                              },
                                            },
                                            terms: Expr {
                                              raw: {
                                                var: "guildId",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                            ],
                          },
                        },
                        lambda: "guildId",
                      },
                    },
                  },
                },
                name: "get_guild_instance",
              },
            },
          },
        },
      },
      if: Expr {
        raw: {
          exists: Expr {
            raw: {
              function: "get_guild_instance",
            },
          },
        },
      },
      then: Expr {
        raw: {
          params: Expr {
            raw: {
              object: {
                body: Expr {
                  raw: {
                    query: Expr {
                      raw: {
                        expr: Expr {
                          raw: {
                            in: Expr {
                              raw: {
                                in: Expr {
                                  raw: {
                                    else: Expr {
                                      raw: {
                                        in: Expr {
                                          raw: {
                                            var: "createdInstance",
                                          },
                                        },
                                        let: [
                                          {
                                            createdInstance: Expr {
                                              raw: {
                                                create: Expr {
                                                  raw: {
                                                    collection: "instance",
                                                  },
                                                },
                                                params: Expr {
                                                  raw: {
                                                    object: {
                                                      data: Expr {
                                                        raw: {
                                                          object: {
                                                            guild: Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "guild",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                            inventories: Expr {
                                                              raw: [],
                                                            },
                                                            main: true,
                                                            packs: Expr {
                                                              raw: [],
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                          {
                                            updatedGuild: Expr {
                                              raw: {
                                                params: Expr {
                                                  raw: {
                                                    object: {
                                                      data: Expr {
                                                        raw: {
                                                          object: {
                                                            instances: Expr {
                                                              raw: [
                                                                Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "createdInstance",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              ],
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                                update: Expr {
                                                  raw: {
                                                    from: Expr {
                                                      raw: {
                                                        var: "guild",
                                                      },
                                                    },
                                                    select: "ref",
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        ],
                                      },
                                    },
                                    if: Expr {
                                      raw: {
                                        is_nonempty: Expr {
                                          raw: {
                                            var: "match",
                                          },
                                        },
                                      },
                                    },
                                    then: Expr {
                                      raw: {
                                        get: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                0,
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    },
                                  },
                                },
                                let: [
                                  {
                                    match: Expr {
                                      raw: {
                                        from: Expr {
                                          raw: {
                                            var: "guild",
                                          },
                                        },
                                        select: Expr {
                                          raw: [
                                            "data",
                                            "instances",
                                          ],
                                        },
                                      },
                                    },
                                  },
                                ],
                              },
                            },
                            let: [
                              {
                                guild: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            create: Expr {
                                              raw: {
                                                collection: "guild",
                                              },
                                            },
                                            params: Expr {
                                              raw: {
                                                object: {
                                                  data: Expr {
                                                    raw: {
                                                      object: {
                                                        id: Expr {
                                                          raw: {
                                                            var: "guildId",
                                                          },
                                                        },
                                                        instances: Expr {
                                                          raw: [],
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            match: Expr {
                                              raw: {
                                                index: "guilds_discord_id",
                                              },
                                            },
                                            terms: Expr {
                                              raw: {
                                                var: "guildId",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                            ],
                          },
                        },
                        lambda: "guildId",
                      },
                    },
                  },
                },
                name: "get_guild_instance",
              },
            },
          },
          update: Expr {
            raw: {
              function: "get_guild_instance",
            },
          },
        },
      },
    },
  },
]
`;

snapshot[`model 7`] = `
[
  Expr {
    raw: {
      else: Expr {
        raw: {
          create_function: Expr {
            raw: {
              object: {
                body: Expr {
                  raw: {
                    query: Expr {
                      raw: {
                        expr: Expr {
                          raw: {
                            in: Expr {
                              raw: {
                                in: Expr {
                                  raw: {
                                    object: {
                                      data: Expr {
                                        raw: {
                                          merge: Expr {
                                            raw: {
                                              from: Expr {
                                                raw: {
                                                  var: "inventory",
                                                },
                                              },
                                              select: Expr {
                                                raw: [
                                                  "data",
                                                ],
                                              },
                                            },
                                          },
                                          with: Expr {
                                            raw: {
                                              object: {
                                                characters: Expr {
                                                  raw: {
                                                    from: Expr {
                                                      raw: {
                                                        after: undefined,
                                                        before: undefined,
                                                        paginate: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                        size: 9999,
                                                      },
                                                    },
                                                    select: Expr {
                                                      raw: [
                                                        "data",
                                                      ],
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                  },
                                },
                                let: [
                                  {
                                    match: Expr {
                                      raw: {
                                        match: Expr {
                                          raw: {
                                            index: "inventory_characters",
                                          },
                                        },
                                        terms: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                var: "inventory",
                                              },
                                            },
                                            select: "ref",
                                          },
                                        },
                                      },
                                    },
                                  },
                                ],
                              },
                            },
                            let: [
                              {
                                user: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            create: Expr {
                                              raw: {
                                                collection: "user",
                                              },
                                            },
                                            params: Expr {
                                              raw: {
                                                object: {
                                                  data: Expr {
                                                    raw: {
                                                      object: {
                                                        id: Expr {
                                                          raw: {
                                                            var: "userId",
                                                          },
                                                        },
                                                        inventories: Expr {
                                                          raw: [],
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            match: Expr {
                                              raw: {
                                                index: "users_discord_id",
                                              },
                                            },
                                            terms: Expr {
                                              raw: {
                                                var: "userId",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                              {
                                guild: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            create: Expr {
                                              raw: {
                                                collection: "guild",
                                              },
                                            },
                                            params: Expr {
                                              raw: {
                                                object: {
                                                  data: Expr {
                                                    raw: {
                                                      object: {
                                                        id: Expr {
                                                          raw: {
                                                            var: "guildId",
                                                          },
                                                        },
                                                        instances: Expr {
                                                          raw: [],
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            match: Expr {
                                              raw: {
                                                index: "guilds_discord_id",
                                              },
                                            },
                                            terms: Expr {
                                              raw: {
                                                var: "guildId",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                              {
                                instance: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            in: Expr {
                                              raw: {
                                                var: "createdInstance",
                                              },
                                            },
                                            let: [
                                              {
                                                createdInstance: Expr {
                                                  raw: {
                                                    create: Expr {
                                                      raw: {
                                                        collection: "instance",
                                                      },
                                                    },
                                                    params: Expr {
                                                      raw: {
                                                        object: {
                                                          data: Expr {
                                                            raw: {
                                                              object: {
                                                                guild: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "guild",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                                inventories: Expr {
                                                                  raw: [],
                                                                },
                                                                main: true,
                                                                packs: Expr {
                                                                  raw: [],
                                                                },
                                                              },
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                              {
                                                updatedGuild: Expr {
                                                  raw: {
                                                    params: Expr {
                                                      raw: {
                                                        object: {
                                                          data: Expr {
                                                            raw: {
                                                              object: {
                                                                instances: Expr {
                                                                  raw: [
                                                                    Expr {
                                                                      raw: {
                                                                        from: Expr {
                                                                          raw: {
                                                                            var: "createdInstance",
                                                                          },
                                                                        },
                                                                        select: "ref",
                                                                      },
                                                                    },
                                                                  ],
                                                                },
                                                              },
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                    update: Expr {
                                                      raw: {
                                                        from: Expr {
                                                          raw: {
                                                            var: "guild",
                                                          },
                                                        },
                                                        select: "ref",
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            ],
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                from: Expr {
                                                  raw: {
                                                    var: "match",
                                                  },
                                                },
                                                select: Expr {
                                                  raw: [
                                                    0,
                                                  ],
                                                },
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                var: "guild",
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                "data",
                                                "instances",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                              {
                                inventory: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        params: Expr {
                                          raw: {
                                            object: {
                                              data: Expr {
                                                raw: {
                                                  object: {
                                                    availablePulls: Expr {
                                                      raw: {
                                                        min: Expr {
                                                          raw: [
                                                            99,
                                                            Expr {
                                                              raw: {
                                                                var: "rechargedPulls",
                                                              },
                                                            },
                                                          ],
                                                        },
                                                      },
                                                    },
                                                    rechargeTimestamp: Expr {
                                                      raw: {
                                                        else: Expr {
                                                          raw: {
                                                            offset: Expr {
                                                              raw: {
                                                                multiply: Expr {
                                                                  raw: [
                                                                    Expr {
                                                                      raw: {
                                                                        var: "newPulls",
                                                                      },
                                                                    },
                                                                    30,
                                                                  ],
                                                                },
                                                              },
                                                            },
                                                            time_add: Expr {
                                                              raw: {
                                                                var: "rechargeTimestamp",
                                                              },
                                                            },
                                                            unit: "minutes",
                                                          },
                                                        },
                                                        if: Expr {
                                                          raw: {
                                                            gte: Expr {
                                                              raw: [
                                                                Expr {
                                                                  raw: {
                                                                    var: "rechargedPulls",
                                                                  },
                                                                },
                                                                5,
                                                              ],
                                                            },
                                                          },
                                                        },
                                                        then: null,
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        update: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                in: Expr {
                                                  raw: {
                                                    else: Expr {
                                                      raw: {
                                                        in: Expr {
                                                          raw: {
                                                            var: "createdInventory",
                                                          },
                                                        },
                                                        let: [
                                                          {
                                                            createdInventory: Expr {
                                                              raw: {
                                                                create: Expr {
                                                                  raw: {
                                                                    collection: "inventory",
                                                                  },
                                                                },
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            availablePulls: 5,
                                                                            instance: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "instance",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                            user: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "user",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedInstance: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "instance",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "instance",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedUser: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "user",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "user",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                        ],
                                                      },
                                                    },
                                                    if: Expr {
                                                      raw: {
                                                        is_nonempty: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                    then: Expr {
                                                      raw: {
                                                        get: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                                let: [
                                                  {
                                                    match: Expr {
                                                      raw: {
                                                        match: Expr {
                                                          raw: {
                                                            index: "inventories_instance_user",
                                                          },
                                                        },
                                                        terms: Expr {
                                                          raw: [
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "instance",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "user",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                          ],
                                                        },
                                                      },
                                                    },
                                                  },
                                                ],
                                              },
                                            },
                                            select: "ref",
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        rechargeTimestamp: Expr {
                                          raw: {
                                            default: Expr {
                                              raw: {
                                                now: null,
                                              },
                                            },
                                            from: Expr {
                                              raw: {
                                                in: Expr {
                                                  raw: {
                                                    else: Expr {
                                                      raw: {
                                                        in: Expr {
                                                          raw: {
                                                            var: "createdInventory",
                                                          },
                                                        },
                                                        let: [
                                                          {
                                                            createdInventory: Expr {
                                                              raw: {
                                                                create: Expr {
                                                                  raw: {
                                                                    collection: "inventory",
                                                                  },
                                                                },
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            availablePulls: 5,
                                                                            instance: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "instance",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                            user: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "user",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedInstance: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "instance",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "instance",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedUser: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "user",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "user",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                        ],
                                                      },
                                                    },
                                                    if: Expr {
                                                      raw: {
                                                        is_nonempty: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                    then: Expr {
                                                      raw: {
                                                        get: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                                let: [
                                                  {
                                                    match: Expr {
                                                      raw: {
                                                        match: Expr {
                                                          raw: {
                                                            index: "inventories_instance_user",
                                                          },
                                                        },
                                                        terms: Expr {
                                                          raw: [
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "instance",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "user",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                          ],
                                                        },
                                                      },
                                                    },
                                                  },
                                                ],
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                "data",
                                                "rechargeTimestamp",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                      {
                                        currentPulls: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                in: Expr {
                                                  raw: {
                                                    else: Expr {
                                                      raw: {
                                                        in: Expr {
                                                          raw: {
                                                            var: "createdInventory",
                                                          },
                                                        },
                                                        let: [
                                                          {
                                                            createdInventory: Expr {
                                                              raw: {
                                                                create: Expr {
                                                                  raw: {
                                                                    collection: "inventory",
                                                                  },
                                                                },
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            availablePulls: 5,
                                                                            instance: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "instance",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                            user: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "user",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedInstance: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "instance",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "instance",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedUser: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "user",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "user",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                        ],
                                                      },
                                                    },
                                                    if: Expr {
                                                      raw: {
                                                        is_nonempty: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                    then: Expr {
                                                      raw: {
                                                        get: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                                let: [
                                                  {
                                                    match: Expr {
                                                      raw: {
                                                        match: Expr {
                                                          raw: {
                                                            index: "inventories_instance_user",
                                                          },
                                                        },
                                                        terms: Expr {
                                                          raw: [
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "instance",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "user",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                          ],
                                                        },
                                                      },
                                                    },
                                                  },
                                                ],
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                "data",
                                                "availablePulls",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                      {
                                        newPulls: Expr {
                                          raw: {
                                            max: Expr {
                                              raw: [
                                                0,
                                                Expr {
                                                  raw: {
                                                    min: Expr {
                                                      raw: [
                                                        Expr {
                                                          raw: {
                                                            subtract: Expr {
                                                              raw: [
                                                                5,
                                                                Expr {
                                                                  raw: {
                                                                    var: "currentPulls",
                                                                  },
                                                                },
                                                              ],
                                                            },
                                                          },
                                                        },
                                                        Expr {
                                                          raw: {
                                                            divide: Expr {
                                                              raw: [
                                                                Expr {
                                                                  raw: {
                                                                    other: Expr {
                                                                      raw: {
                                                                        now: null,
                                                                      },
                                                                    },
                                                                    time_diff: Expr {
                                                                      raw: {
                                                                        var: "rechargeTimestamp",
                                                                      },
                                                                    },
                                                                    unit: "minutes",
                                                                  },
                                                                },
                                                                30,
                                                              ],
                                                            },
                                                          },
                                                        },
                                                      ],
                                                    },
                                                  },
                                                },
                                              ],
                                            },
                                          },
                                        },
                                      },
                                      {
                                        rechargedPulls: Expr {
                                          raw: {
                                            add: Expr {
                                              raw: [
                                                Expr {
                                                  raw: {
                                                    var: "currentPulls",
                                                  },
                                                },
                                                Expr {
                                                  raw: {
                                                    var: "newPulls",
                                                  },
                                                },
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                            ],
                          },
                        },
                        lambda: Expr {
                          raw: [
                            "userId",
                            "guildId",
                          ],
                        },
                      },
                    },
                  },
                },
                name: "get_user_inventory",
              },
            },
          },
        },
      },
      if: Expr {
        raw: {
          exists: Expr {
            raw: {
              function: "get_user_inventory",
            },
          },
        },
      },
      then: Expr {
        raw: {
          params: Expr {
            raw: {
              object: {
                body: Expr {
                  raw: {
                    query: Expr {
                      raw: {
                        expr: Expr {
                          raw: {
                            in: Expr {
                              raw: {
                                in: Expr {
                                  raw: {
                                    object: {
                                      data: Expr {
                                        raw: {
                                          merge: Expr {
                                            raw: {
                                              from: Expr {
                                                raw: {
                                                  var: "inventory",
                                                },
                                              },
                                              select: Expr {
                                                raw: [
                                                  "data",
                                                ],
                                              },
                                            },
                                          },
                                          with: Expr {
                                            raw: {
                                              object: {
                                                characters: Expr {
                                                  raw: {
                                                    from: Expr {
                                                      raw: {
                                                        after: undefined,
                                                        before: undefined,
                                                        paginate: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                        size: 9999,
                                                      },
                                                    },
                                                    select: Expr {
                                                      raw: [
                                                        "data",
                                                      ],
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                  },
                                },
                                let: [
                                  {
                                    match: Expr {
                                      raw: {
                                        match: Expr {
                                          raw: {
                                            index: "inventory_characters",
                                          },
                                        },
                                        terms: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                var: "inventory",
                                              },
                                            },
                                            select: "ref",
                                          },
                                        },
                                      },
                                    },
                                  },
                                ],
                              },
                            },
                            let: [
                              {
                                user: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            create: Expr {
                                              raw: {
                                                collection: "user",
                                              },
                                            },
                                            params: Expr {
                                              raw: {
                                                object: {
                                                  data: Expr {
                                                    raw: {
                                                      object: {
                                                        id: Expr {
                                                          raw: {
                                                            var: "userId",
                                                          },
                                                        },
                                                        inventories: Expr {
                                                          raw: [],
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            match: Expr {
                                              raw: {
                                                index: "users_discord_id",
                                              },
                                            },
                                            terms: Expr {
                                              raw: {
                                                var: "userId",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                              {
                                guild: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            create: Expr {
                                              raw: {
                                                collection: "guild",
                                              },
                                            },
                                            params: Expr {
                                              raw: {
                                                object: {
                                                  data: Expr {
                                                    raw: {
                                                      object: {
                                                        id: Expr {
                                                          raw: {
                                                            var: "guildId",
                                                          },
                                                        },
                                                        instances: Expr {
                                                          raw: [],
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            match: Expr {
                                              raw: {
                                                index: "guilds_discord_id",
                                              },
                                            },
                                            terms: Expr {
                                              raw: {
                                                var: "guildId",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                              {
                                instance: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            in: Expr {
                                              raw: {
                                                var: "createdInstance",
                                              },
                                            },
                                            let: [
                                              {
                                                createdInstance: Expr {
                                                  raw: {
                                                    create: Expr {
                                                      raw: {
                                                        collection: "instance",
                                                      },
                                                    },
                                                    params: Expr {
                                                      raw: {
                                                        object: {
                                                          data: Expr {
                                                            raw: {
                                                              object: {
                                                                guild: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "guild",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                                inventories: Expr {
                                                                  raw: [],
                                                                },
                                                                main: true,
                                                                packs: Expr {
                                                                  raw: [],
                                                                },
                                                              },
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                              {
                                                updatedGuild: Expr {
                                                  raw: {
                                                    params: Expr {
                                                      raw: {
                                                        object: {
                                                          data: Expr {
                                                            raw: {
                                                              object: {
                                                                instances: Expr {
                                                                  raw: [
                                                                    Expr {
                                                                      raw: {
                                                                        from: Expr {
                                                                          raw: {
                                                                            var: "createdInstance",
                                                                          },
                                                                        },
                                                                        select: "ref",
                                                                      },
                                                                    },
                                                                  ],
                                                                },
                                                              },
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                    update: Expr {
                                                      raw: {
                                                        from: Expr {
                                                          raw: {
                                                            var: "guild",
                                                          },
                                                        },
                                                        select: "ref",
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            ],
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                from: Expr {
                                                  raw: {
                                                    var: "match",
                                                  },
                                                },
                                                select: Expr {
                                                  raw: [
                                                    0,
                                                  ],
                                                },
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                var: "guild",
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                "data",
                                                "instances",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                              {
                                inventory: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        params: Expr {
                                          raw: {
                                            object: {
                                              data: Expr {
                                                raw: {
                                                  object: {
                                                    availablePulls: Expr {
                                                      raw: {
                                                        min: Expr {
                                                          raw: [
                                                            99,
                                                            Expr {
                                                              raw: {
                                                                var: "rechargedPulls",
                                                              },
                                                            },
                                                          ],
                                                        },
                                                      },
                                                    },
                                                    rechargeTimestamp: Expr {
                                                      raw: {
                                                        else: Expr {
                                                          raw: {
                                                            offset: Expr {
                                                              raw: {
                                                                multiply: Expr {
                                                                  raw: [
                                                                    Expr {
                                                                      raw: {
                                                                        var: "newPulls",
                                                                      },
                                                                    },
                                                                    30,
                                                                  ],
                                                                },
                                                              },
                                                            },
                                                            time_add: Expr {
                                                              raw: {
                                                                var: "rechargeTimestamp",
                                                              },
                                                            },
                                                            unit: "minutes",
                                                          },
                                                        },
                                                        if: Expr {
                                                          raw: {
                                                            gte: Expr {
                                                              raw: [
                                                                Expr {
                                                                  raw: {
                                                                    var: "rechargedPulls",
                                                                  },
                                                                },
                                                                5,
                                                              ],
                                                            },
                                                          },
                                                        },
                                                        then: null,
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        update: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                in: Expr {
                                                  raw: {
                                                    else: Expr {
                                                      raw: {
                                                        in: Expr {
                                                          raw: {
                                                            var: "createdInventory",
                                                          },
                                                        },
                                                        let: [
                                                          {
                                                            createdInventory: Expr {
                                                              raw: {
                                                                create: Expr {
                                                                  raw: {
                                                                    collection: "inventory",
                                                                  },
                                                                },
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            availablePulls: 5,
                                                                            instance: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "instance",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                            user: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "user",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedInstance: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "instance",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "instance",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedUser: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "user",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "user",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                        ],
                                                      },
                                                    },
                                                    if: Expr {
                                                      raw: {
                                                        is_nonempty: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                    then: Expr {
                                                      raw: {
                                                        get: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                                let: [
                                                  {
                                                    match: Expr {
                                                      raw: {
                                                        match: Expr {
                                                          raw: {
                                                            index: "inventories_instance_user",
                                                          },
                                                        },
                                                        terms: Expr {
                                                          raw: [
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "instance",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "user",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                          ],
                                                        },
                                                      },
                                                    },
                                                  },
                                                ],
                                              },
                                            },
                                            select: "ref",
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        rechargeTimestamp: Expr {
                                          raw: {
                                            default: Expr {
                                              raw: {
                                                now: null,
                                              },
                                            },
                                            from: Expr {
                                              raw: {
                                                in: Expr {
                                                  raw: {
                                                    else: Expr {
                                                      raw: {
                                                        in: Expr {
                                                          raw: {
                                                            var: "createdInventory",
                                                          },
                                                        },
                                                        let: [
                                                          {
                                                            createdInventory: Expr {
                                                              raw: {
                                                                create: Expr {
                                                                  raw: {
                                                                    collection: "inventory",
                                                                  },
                                                                },
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            availablePulls: 5,
                                                                            instance: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "instance",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                            user: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "user",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedInstance: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "instance",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "instance",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedUser: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "user",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "user",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                        ],
                                                      },
                                                    },
                                                    if: Expr {
                                                      raw: {
                                                        is_nonempty: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                    then: Expr {
                                                      raw: {
                                                        get: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                                let: [
                                                  {
                                                    match: Expr {
                                                      raw: {
                                                        match: Expr {
                                                          raw: {
                                                            index: "inventories_instance_user",
                                                          },
                                                        },
                                                        terms: Expr {
                                                          raw: [
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "instance",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "user",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                          ],
                                                        },
                                                      },
                                                    },
                                                  },
                                                ],
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                "data",
                                                "rechargeTimestamp",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                      {
                                        currentPulls: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                in: Expr {
                                                  raw: {
                                                    else: Expr {
                                                      raw: {
                                                        in: Expr {
                                                          raw: {
                                                            var: "createdInventory",
                                                          },
                                                        },
                                                        let: [
                                                          {
                                                            createdInventory: Expr {
                                                              raw: {
                                                                create: Expr {
                                                                  raw: {
                                                                    collection: "inventory",
                                                                  },
                                                                },
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            availablePulls: 5,
                                                                            instance: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "instance",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                            user: Expr {
                                                                              raw: {
                                                                                from: Expr {
                                                                                  raw: {
                                                                                    var: "user",
                                                                                  },
                                                                                },
                                                                                select: "ref",
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedInstance: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "instance",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "instance",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                          {
                                                            updatedUser: Expr {
                                                              raw: {
                                                                params: Expr {
                                                                  raw: {
                                                                    object: {
                                                                      data: Expr {
                                                                        raw: {
                                                                          object: {
                                                                            inventories: Expr {
                                                                              raw: {
                                                                                append: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "createdInventory",
                                                                                      },
                                                                                    },
                                                                                    select: "ref",
                                                                                  },
                                                                                },
                                                                                collection: Expr {
                                                                                  raw: {
                                                                                    from: Expr {
                                                                                      raw: {
                                                                                        var: "user",
                                                                                      },
                                                                                    },
                                                                                    select: Expr {
                                                                                      raw: [
                                                                                        "data",
                                                                                        "inventories",
                                                                                      ],
                                                                                    },
                                                                                  },
                                                                                },
                                                                              },
                                                                            },
                                                                          },
                                                                        },
                                                                      },
                                                                    },
                                                                  },
                                                                },
                                                                update: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "user",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                              },
                                                            },
                                                          },
                                                        ],
                                                      },
                                                    },
                                                    if: Expr {
                                                      raw: {
                                                        is_nonempty: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                    then: Expr {
                                                      raw: {
                                                        get: Expr {
                                                          raw: {
                                                            var: "match",
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                                let: [
                                                  {
                                                    match: Expr {
                                                      raw: {
                                                        match: Expr {
                                                          raw: {
                                                            index: "inventories_instance_user",
                                                          },
                                                        },
                                                        terms: Expr {
                                                          raw: [
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "instance",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                            Expr {
                                                              raw: {
                                                                from: Expr {
                                                                  raw: {
                                                                    var: "user",
                                                                  },
                                                                },
                                                                select: "ref",
                                                              },
                                                            },
                                                          ],
                                                        },
                                                      },
                                                    },
                                                  },
                                                ],
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                "data",
                                                "availablePulls",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                      {
                                        newPulls: Expr {
                                          raw: {
                                            max: Expr {
                                              raw: [
                                                0,
                                                Expr {
                                                  raw: {
                                                    min: Expr {
                                                      raw: [
                                                        Expr {
                                                          raw: {
                                                            subtract: Expr {
                                                              raw: [
                                                                5,
                                                                Expr {
                                                                  raw: {
                                                                    var: "currentPulls",
                                                                  },
                                                                },
                                                              ],
                                                            },
                                                          },
                                                        },
                                                        Expr {
                                                          raw: {
                                                            divide: Expr {
                                                              raw: [
                                                                Expr {
                                                                  raw: {
                                                                    other: Expr {
                                                                      raw: {
                                                                        now: null,
                                                                      },
                                                                    },
                                                                    time_diff: Expr {
                                                                      raw: {
                                                                        var: "rechargeTimestamp",
                                                                      },
                                                                    },
                                                                    unit: "minutes",
                                                                  },
                                                                },
                                                                30,
                                                              ],
                                                            },
                                                          },
                                                        },
                                                      ],
                                                    },
                                                  },
                                                },
                                              ],
                                            },
                                          },
                                        },
                                      },
                                      {
                                        rechargedPulls: Expr {
                                          raw: {
                                            add: Expr {
                                              raw: [
                                                Expr {
                                                  raw: {
                                                    var: "currentPulls",
                                                  },
                                                },
                                                Expr {
                                                  raw: {
                                                    var: "newPulls",
                                                  },
                                                },
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                            ],
                          },
                        },
                        lambda: Expr {
                          raw: [
                            "userId",
                            "guildId",
                          ],
                        },
                      },
                    },
                  },
                },
                name: "get_user_inventory",
              },
            },
          },
          update: Expr {
            raw: {
              function: "get_user_inventory",
            },
          },
        },
      },
    },
  },
]
`;

snapshot[`model 8`] = `
[
  Expr {
    raw: {
      else: Expr {
        raw: {
          create_function: Expr {
            raw: {
              object: {
                body: Expr {
                  raw: {
                    query: Expr {
                      raw: {
                        expr: Expr {
                          raw: {
                            in: Expr {
                              raw: {
                                in: Expr {
                                  raw: {
                                    from: Expr {
                                      raw: {
                                        collection: Expr {
                                          raw: {
                                            var: "matches",
                                          },
                                        },
                                        map: Expr {
                                          raw: {
                                            expr: Expr {
                                              raw: {
                                                get: Expr {
                                                  raw: {
                                                    var: "ref",
                                                  },
                                                },
                                              },
                                            },
                                            lambda: Expr {
                                              raw: [
                                                "_",
                                                "ref",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    },
                                    select: Expr {
                                      raw: [
                                        "data",
                                      ],
                                    },
                                  },
                                },
                                let: [
                                  {
                                    matches: Expr {
                                      raw: {
                                        after: undefined,
                                        before: undefined,
                                        paginate: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                offset: 14,
                                                time_subtract: Expr {
                                                  raw: {
                                                    now: null,
                                                  },
                                                },
                                                unit: "days",
                                              },
                                            },
                                            range: Expr {
                                              raw: {
                                                match: Expr {
                                                  raw: {
                                                    index: "inventories_last_pull",
                                                  },
                                                },
                                                terms: Expr {
                                                  raw: {
                                                    from: Expr {
                                                      raw: {
                                                        var: "instance",
                                                      },
                                                    },
                                                    select: "ref",
                                                  },
                                                },
                                              },
                                            },
                                            to: Expr {
                                              raw: {
                                                now: null,
                                              },
                                            },
                                          },
                                        },
                                        size: 30,
                                      },
                                    },
                                  },
                                ],
                              },
                            },
                            let: [
                              {
                                guild: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            create: Expr {
                                              raw: {
                                                collection: "guild",
                                              },
                                            },
                                            params: Expr {
                                              raw: {
                                                object: {
                                                  data: Expr {
                                                    raw: {
                                                      object: {
                                                        id: Expr {
                                                          raw: {
                                                            var: "guildId",
                                                          },
                                                        },
                                                        instances: Expr {
                                                          raw: [],
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            match: Expr {
                                              raw: {
                                                index: "guilds_discord_id",
                                              },
                                            },
                                            terms: Expr {
                                              raw: {
                                                var: "guildId",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                              {
                                instance: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            in: Expr {
                                              raw: {
                                                var: "createdInstance",
                                              },
                                            },
                                            let: [
                                              {
                                                createdInstance: Expr {
                                                  raw: {
                                                    create: Expr {
                                                      raw: {
                                                        collection: "instance",
                                                      },
                                                    },
                                                    params: Expr {
                                                      raw: {
                                                        object: {
                                                          data: Expr {
                                                            raw: {
                                                              object: {
                                                                guild: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "guild",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                                inventories: Expr {
                                                                  raw: [],
                                                                },
                                                                main: true,
                                                                packs: Expr {
                                                                  raw: [],
                                                                },
                                                              },
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                              {
                                                updatedGuild: Expr {
                                                  raw: {
                                                    params: Expr {
                                                      raw: {
                                                        object: {
                                                          data: Expr {
                                                            raw: {
                                                              object: {
                                                                instances: Expr {
                                                                  raw: [
                                                                    Expr {
                                                                      raw: {
                                                                        from: Expr {
                                                                          raw: {
                                                                            var: "createdInstance",
                                                                          },
                                                                        },
                                                                        select: "ref",
                                                                      },
                                                                    },
                                                                  ],
                                                                },
                                                              },
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                    update: Expr {
                                                      raw: {
                                                        from: Expr {
                                                          raw: {
                                                            var: "guild",
                                                          },
                                                        },
                                                        select: "ref",
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            ],
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                from: Expr {
                                                  raw: {
                                                    var: "match",
                                                  },
                                                },
                                                select: Expr {
                                                  raw: [
                                                    0,
                                                  ],
                                                },
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                var: "guild",
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                "data",
                                                "instances",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                            ],
                          },
                        },
                        lambda: "guildId",
                      },
                    },
                  },
                },
                name: "get_active_inventories",
              },
            },
          },
        },
      },
      if: Expr {
        raw: {
          exists: Expr {
            raw: {
              function: "get_active_inventories",
            },
          },
        },
      },
      then: Expr {
        raw: {
          params: Expr {
            raw: {
              object: {
                body: Expr {
                  raw: {
                    query: Expr {
                      raw: {
                        expr: Expr {
                          raw: {
                            in: Expr {
                              raw: {
                                in: Expr {
                                  raw: {
                                    from: Expr {
                                      raw: {
                                        collection: Expr {
                                          raw: {
                                            var: "matches",
                                          },
                                        },
                                        map: Expr {
                                          raw: {
                                            expr: Expr {
                                              raw: {
                                                get: Expr {
                                                  raw: {
                                                    var: "ref",
                                                  },
                                                },
                                              },
                                            },
                                            lambda: Expr {
                                              raw: [
                                                "_",
                                                "ref",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    },
                                    select: Expr {
                                      raw: [
                                        "data",
                                      ],
                                    },
                                  },
                                },
                                let: [
                                  {
                                    matches: Expr {
                                      raw: {
                                        after: undefined,
                                        before: undefined,
                                        paginate: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                offset: 14,
                                                time_subtract: Expr {
                                                  raw: {
                                                    now: null,
                                                  },
                                                },
                                                unit: "days",
                                              },
                                            },
                                            range: Expr {
                                              raw: {
                                                match: Expr {
                                                  raw: {
                                                    index: "inventories_last_pull",
                                                  },
                                                },
                                                terms: Expr {
                                                  raw: {
                                                    from: Expr {
                                                      raw: {
                                                        var: "instance",
                                                      },
                                                    },
                                                    select: "ref",
                                                  },
                                                },
                                              },
                                            },
                                            to: Expr {
                                              raw: {
                                                now: null,
                                              },
                                            },
                                          },
                                        },
                                        size: 30,
                                      },
                                    },
                                  },
                                ],
                              },
                            },
                            let: [
                              {
                                guild: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            create: Expr {
                                              raw: {
                                                collection: "guild",
                                              },
                                            },
                                            params: Expr {
                                              raw: {
                                                object: {
                                                  data: Expr {
                                                    raw: {
                                                      object: {
                                                        id: Expr {
                                                          raw: {
                                                            var: "guildId",
                                                          },
                                                        },
                                                        instances: Expr {
                                                          raw: [],
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            },
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            match: Expr {
                                              raw: {
                                                index: "guilds_discord_id",
                                              },
                                            },
                                            terms: Expr {
                                              raw: {
                                                var: "guildId",
                                              },
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                              {
                                instance: Expr {
                                  raw: {
                                    in: Expr {
                                      raw: {
                                        else: Expr {
                                          raw: {
                                            in: Expr {
                                              raw: {
                                                var: "createdInstance",
                                              },
                                            },
                                            let: [
                                              {
                                                createdInstance: Expr {
                                                  raw: {
                                                    create: Expr {
                                                      raw: {
                                                        collection: "instance",
                                                      },
                                                    },
                                                    params: Expr {
                                                      raw: {
                                                        object: {
                                                          data: Expr {
                                                            raw: {
                                                              object: {
                                                                guild: Expr {
                                                                  raw: {
                                                                    from: Expr {
                                                                      raw: {
                                                                        var: "guild",
                                                                      },
                                                                    },
                                                                    select: "ref",
                                                                  },
                                                                },
                                                                inventories: Expr {
                                                                  raw: [],
                                                                },
                                                                main: true,
                                                                packs: Expr {
                                                                  raw: [],
                                                                },
                                                              },
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                              {
                                                updatedGuild: Expr {
                                                  raw: {
                                                    params: Expr {
                                                      raw: {
                                                        object: {
                                                          data: Expr {
                                                            raw: {
                                                              object: {
                                                                instances: Expr {
                                                                  raw: [
                                                                    Expr {
                                                                      raw: {
                                                                        from: Expr {
                                                                          raw: {
                                                                            var: "createdInstance",
                                                                          },
                                                                        },
                                                                        select: "ref",
                                                                      },
                                                                    },
                                                                  ],
                                                                },
                                                              },
                                                            },
                                                          },
                                                        },
                                                      },
                                                    },
                                                    update: Expr {
                                                      raw: {
                                                        from: Expr {
                                                          raw: {
                                                            var: "guild",
                                                          },
                                                        },
                                                        select: "ref",
                                                      },
                                                    },
                                                  },
                                                },
                                              },
                                            ],
                                          },
                                        },
                                        if: Expr {
                                          raw: {
                                            is_nonempty: Expr {
                                              raw: {
                                                var: "match",
                                              },
                                            },
                                          },
                                        },
                                        then: Expr {
                                          raw: {
                                            get: Expr {
                                              raw: {
                                                from: Expr {
                                                  raw: {
                                                    var: "match",
                                                  },
                                                },
                                                select: Expr {
                                                  raw: [
                                                    0,
                                                  ],
                                                },
                                              },
                                            },
                                          },
                                        },
                                      },
                                    },
                                    let: [
                                      {
                                        match: Expr {
                                          raw: {
                                            from: Expr {
                                              raw: {
                                                var: "guild",
                                              },
                                            },
                                            select: Expr {
                                              raw: [
                                                "data",
                                                "instances",
                                              ],
                                            },
                                          },
                                        },
                                      },
                                    ],
                                  },
                                },
                              },
                            ],
                          },
                        },
                        lambda: "guildId",
                      },
                    },
                  },
                },
                name: "get_active_inventories",
              },
            },
          },
          update: Expr {
            raw: {
              function: "get_active_inventories",
            },
          },
        },
      },
    },
  },
]
`;
